<div class="card card-custom card-sticky gutter-b" id="kt_page_sticky_card">
  <!-- Header -->
  <div class="card-header card-header-tabs-line">
    <div class="card-toolbar mr-4">
      <ul class="nav nav-tabs nav-bold nav-tabs-line">
        <li class="nav-item">
          <a class="nav-link" (click)='step = null' [ngClass]="!loanedPiece.loanedPieceId ? 'active' : ''"
            data-toggle="tab" href="#kt_tab_pane_7_1">
            <span class="nav-icon"><i class="fa fa-info-circle"></i></span>
            <span class="nav-text">Loan Details</span>
          </a>
        </li>
        <li class="nav-item">
          <ng-container *ngIf="loanedPiece.loanedPieceId; else elseTemplateAnchor">
            <a class="nav-link" (click)='step = null'
              [ngClass]="loanedPiece.loanedPieceId && step!='final' ? 'active' : ''" data-toggle="tab"
              [attr.href]='loanedPiece.loanedPieceId ? "#kt_tab_pane_7_2":"#"'>
              <span class="nav-icon"><i class="fas fa-sign-in-alt"></i></span>
              <span class="nav-text">Return Management</span></a>
          </ng-container>
          <ng-template #elseTemplateAnchor>
            <p class="nav-link"
              (click)='toastrUtil.showWarning("Cannot continue, please create loan first...","Cannot Proceed")'>
              <span class="nav-icon"><i class="fas fa-sign-in-alt"></i></span>
              <span class="nav-text">Return Management</span>
            </p>
          </ng-template>
        </li>
        <li class="nav-item">
          <ng-container *ngIf="loanedPiece.loanedPieceId; else elseTemplateAnchorLast">
            <a class="nav-link" (click)='step = "final"'
              [ngClass]="loanedPiece.loanedPieceId && step=='final' ? 'active' : ''" data-toggle="tab"
              [attr.href]='loanedPiece.loanedPieceId ? "#kt_tab_pane_7_3":"#"'>
              <span class="nav-icon"><i class="fas fa-stamp"></i></span>
              <span class="nav-text">Sign Off</span></a>
          </ng-container>
          <ng-template #elseTemplateAnchorLast>
            <p class="nav-link"
              (click)='toastrUtil.showWarning("Cannot continue, please create loan first...","Cannot Proceed")'>
              <span class="nav-icon"><i class="fas fa-stamp"></i></span>
              <span class="nav-text">Sign Off</span>
            </p>
          </ng-template>
        </li>
      </ul>
    </div>
    <div class="card-toolbar flex-grow-1  justify-content-end">
      <button [disabled]="saving" (click)="saveForm()" class="btn btn-light-primary font-weight-bolder mr-2" [ngClass]="{
          'spinner spinner-left': saving
        }">
        <ng-container *ngIf="!loanedPiece.loanedPieceId; else elseTemplate">
          Create Loan
        </ng-container>
        <ng-template #elseTemplate>
          <ng-container *ngIf="step=='final'; else elseTemplate">
            Close Loan
          </ng-container>
          <ng-template #elseTemplate>
            Edit Loan
          </ng-template>
        </ng-template>
      </button>
    </div>
  </div>
  <!-- Body -->
  <div class="card-body">
    <div>
      <div class="tab-content">
        <div class="tab-pane fade" [ngClass]="!loanedPiece.loanedPieceId ? 'show active' : ''" id="kt_tab_pane_7_1"
          role="tabpanel" aria-labelledby="kt_tab_pane_7_1">
          <div class="row">
            <div class="col-xl-2"></div>
            <div class="col-xl-8">
              <app-loan-details [loanedPiece]="loanedPiece" [loaningUser]="loaningUser" [loanForm]="loanForm">
              </app-loan-details>
              <!-- <app-personal-information [(personalForm)]="formContainer.controls.personalForm"
                (personalFormCounted)="personalFormProgress = $event" [role]="role" [initialData]="initialData">
              </app-personal-information> -->
            </div>
            <div class="col-xl-2"></div>
          </div>
        </div>
        <div class="tab-pane fade" [ngClass]="loanedPiece.loanedPieceId && step !='final' ? 'show active' : ''"
          id="kt_tab_pane_7_2" role="tabpanel" aria-labelledby="kt_tab_pane_7_2">
          <div class="row">
            <div class="col-xl-2"></div>
            <div class="col-xl-8">
              <app-return-details [loanedPiece]="loanedPiece" [loaningUser]="loaningUser" [loanForm]="loanForm">
              </app-return-details>
              <!-- <app-organizational-information [(organizationalForm)]="
                    formContainer.controls.organizationalForm
                  " (organizationalFormCounted)="
                    organizationalFormProgress = $event
                  " [role]="role" [initialData]="initialData"></app-organizational-information> -->
            </div>
            <div class="col-xl-2"></div>
          </div>
        </div>
        <div class="tab-pane fade" [ngClass]="loanedPiece.loanedPieceId && step =='final' ? 'show active' : ''"
          id="kt_tab_pane_7_3" role="tabpanel" aria-labelledby="kt_tab_pane_7_3">
          <div class="row">
            <div class="col-xl-2"></div>
            <div class="col-xl-8">
              <app-sign-off [loanedPiece]="loanedPiece" [loaningUser]="loaningUser" [loanForm]="loanForm">
              </app-sign-off>
              <!-- <app-scan-uploads [(scansForm)]="formContainer.controls.scansForm"
                (scansFormCounted)="scansFormProgress = $event" [upload]="saveScanFiles.asObservable()"
                (saving)="savingScans = $event" (sending)="sendingScans = $event"></app-scan-uploads> -->
            </div>
            <div class="col-xl-2"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>