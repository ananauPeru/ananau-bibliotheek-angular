<div class="row">
    <div class="col-12">
        <div class="form-group">
            <label>Choose a Book or an Educational Item to be loaned out.</label>
            <div class="input-group">
                <div class="input-group-prepend col-2 pr-0 pl-0">
                    <button type="button" class="btn btn-secondary btn-block dropdown-toggle" data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="false" [disabled]="loanedPiece.loanedPieceId?true:false"
                        id="bookitem">
                        {{type}}&nbsp;
                        <i class="fas fa-caret-down"></i>
                    </button>
                    <div class="dropdown-menu" aria-labelledby="bookitem">
                        <a class="dropdown-item text-dark" (click)='type = "Books"'>Books</a>
                        <a class="dropdown-item text-dark" (click)='type = "Items"'>Educational Items</a>
                    </div>
                </div>
                <div class="input-group-append col-10 pl-0 pr-0">
                    <input type="text" class="form-control form-control-lg form-control-solid dropdown-toggle"
                        id="dropdownMenuButton" data-toggle="dropdown" aria-label="Text input with dropdown button"
                        placeholder="Type in the title of the Item/Book" value='{{item ? item.name : filter}}'
                        (input)="setFilter($event.target.value)" [disabled]="loanedPiece.loanedPieceId?true:false" />
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="itemsDropdown">
                        <a class="dropdown-item text-dark" (click)="setItem(i)"
                            *ngFor="let i of filteredList() | async">{{i.name}}</a>
                    </div>
                </div>
            </div>
            <span class="form-text text-muted">Type in the name of the desired item, you can choose from the filtered
                results...</span>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-12">
        <div class="form-group">
            <label>Choose the User who is loaning out the Book/Item.</label>
            <div class="input-group">
                <div class="input-group-prepend col-2 pr-0 pl-0">
                    <button type="button" class="btn btn-secondary btn-block dropdown-toggle" data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="false" id="bookitem"
                        [disabled]="loanedPiece.loanedPieceId?true:false">
                        User
                    </button>
                </div>
                <div class="input-group-append col-10 pl-0 pr-0">
                    <input type="text" class="form-control form-control-lg form-control-solid dropdown-toggle"
                        id="dropdownMenuButtonUser" data-toggle="dropdown" aria-label="Text input with dropdown button"
                        placeholder="Type in a name or email"
                        value='{{loaningUser && loaningUser.userDetail ? loaningUser.userDetail.firstName+ " " +loaningUser.userDetail.lastName +" • "+loaningUser.email : ""}}'
                        (input)="userFilter = $event.target.value" [disabled]="loanedPiece.loanedPieceId?true:false" />
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButtonUser" id="usersDropdown">
                        <a class="dropdown-item text-dark" (click)="setUser(i.user)"
                            *ngFor="let i of filteredUserList() | async">{{i.user.userDetail.firstName + '
                            '+i.user.userDetail.lastName +' • '+i.user.email }}</a>
                    </div>
                </div>
            </div>
            <span class="form-text text-muted">Type in the name or email of the user, you can choose from the filtered
                results...</span>
        </div>
    </div>
</div>
<form action="#" class="form form-label-right" [formGroup]="loanForm">
    <div class="row form-group">
        <div class="col-12 col-md-6 mb-3">
            <label>
                Loaned At
            </label>
            <ng-container *ngIf="loanedPiece.loanedPieceId; else elseTemplate">
                <input class="form-control form-control-solid form-control-lg" ngbDatepicker
               name="loanDate" formControlName="loanDate" placeholder="2000-01-01"
                autocomplete="off" [class.is-invalid]="isControlInvalid('loanDate')"
                [class.is-valid]="isControlValid('loanDate')" [disabled]="true"
                required />
            </ng-container>
            <ng-template #elseTemplate>
                <input class="form-control form-control-solid form-control-lg" (click)="d.toggle()" ngbDatepicker
                #d="ngbDatepicker" name="loanDate" formControlName="loanDate" placeholder="2000-01-01"
                autocomplete="off" [class.is-invalid]="isControlInvalid('loanDate')"
                [class.is-valid]="isControlValid('loanDate')" [disabled]="loanedPiece.loanedPieceId?true:false"
                required />
            </ng-template>        
           
            <div class="feedback" *ngIf="!isControlTouched('loanDate')">
                Please enter <b>the Loaned Date of the item.</b>
            </div>
            <div class="valid-feedback" *ngIf="isControlValid('loanDate')">
                <!-- Brand was entered correct -->
            </div>
            <div class="invalid-feedback" *ngIf="controlHasError('required', 'loanDate')">
                Loaned date is required
            </div>
        </div>
        <div class="col-12 col-md-6 mb-3">
            <label>
                Expected Return Date
            </label>
            <input class="form-control form-control-solid form-control-lg" (click)="d.toggle()" ngbDatepicker
                #d="ngbDatepicker" name="returnDate" formControlName="returnDate" placeholder="2000-01-01"
                autocomplete="off" [class.is-invalid]="isControlInvalid('returnDate')"
                [class.is-valid]="isControlValid('returnDate')" required />
            <div class="feedback" *ngIf="!isControlTouched('returnDate')">
                Please enter <b>the expected Return Date of the item.</b>
            </div>
            <div class="valid-feedback" *ngIf="isControlValid('returnDate')">
                <!-- Brand was entered correct -->
            </div>
            <div class="invalid-feedback" *ngIf="controlHasError('required', 'returnDate')">
                Expected Return date is required
            </div>
        </div>
        <div class="col-12 col-md-6 mb-3">
            <label>State when Loaning</label>

            <ng-container *ngIf="loanedPiece.loanedPieceId; else elseTemplateState">
                <select class="form-control form-control-lg form-control-solid" name="loanState"
                    formControlName="loanState" [class.is-invalid]="isControlInvalid('loanState')"
                    [class.is-valid]="isControlValid('loanState')"
                    [attr.disabled]='loanedPiece.loanedPieceId?true:false' required>
                    <option value='GOOD'>Good</option>
                    <option value="NORMAL USAGE SIGNS">Normal usage signs</option>
                    <option value="BAD">Bad</option>
                </select>
                <div class="feedback" *ngIf="!isControlTouched('loanState')">Please select a <b>State</b> for the item.
                </div>
                <div class="invalid-feedback" *ngIf="controlHasError('required', 'loanState')">
                    State is required
                </div>
            </ng-container>
            <ng-template #elseTemplateState>
                <select class="form-control form-control-lg form-control-solid" name="loanState"
                    formControlName="loanState" [class.is-invalid]="isControlInvalid('loanState')"
                    [class.is-valid]="isControlValid('loanState')" required>
                    <option value='GOOD'>Good</option>
                    <option value="NORMAL USAGE SIGNS">Normal usage signs</option>
                    <option value="BAD">Bad</option>
                </select>
                <div class="feedback" *ngIf="!isControlTouched('loanState')">Please select a <b>State</b> for the item.
                </div>
                <div class="invalid-feedback" *ngIf="controlHasError('required', 'loanState')">
                    State is required
                </div>
            </ng-template>
        </div>
        <div class="col-12 col-md-6 mb-3">
            <label>Quantity</label>
            <input type="number" min="1" max="1000" step="1" class="form-control form-control-lg form-control-solid"
                autocomplete="off" placeholder="1" name='quantity' [class.is-invalid]="isControlInvalid('quantity')"
                [class.is-valid]="isControlValid('quantity')" formControlName='quantity'
                [readonly]="loanedPiece.loanedPieceId?true:false" required />
            <div class="feedback" *ngIf="!isControlTouched('quantity')">
                Please enter <b>the Quantity of the loaned items.</b>
            </div>
            <div class="valid-feedback" *ngIf="isControlValid('quantity')">
                <!-- Name was entered correct -->
            </div>
            <div class="invalid-feedback" *ngIf="controlHasError('required', 'quantity')">
                Quantity is required.
            </div>
            <div class="invalid-feedback" *ngIf="controlHasError('min', 'quantity')">
                The minimum Quantity should be 1.
            </div>
            <div class="invalid-feedback" *ngIf="controlHasError('max', 'quantity')">
                The maximum Quantity should be 1000.
            </div>
        </div>
        <div class="col-12 mb-3">
            <label>State Description</label>
            <textarea [readonly]="loanedPiece.loanedPieceId?true:false" style="min-height: 250px;"
                class="form-control form-control-lg form-control-solid"
                placeholder="Please describe the state in more detail if necessary."
                formControlName='loanStateDescription'></textarea>
        </div>
    </div>
</form>