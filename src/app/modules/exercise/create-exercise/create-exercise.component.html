<form
  [formGroup]="exerciseForm"
  *ngIf="
    AuthUtil.permitted([
      AuthUtil.roles.SpanishTeacher,
      AuthUtil.roles.SuperAdmin
    ]);
    else noAccess
  "
>
  <div class="card card-custom mb-4">
    <!-- Header -->
    <div class="row pb-0 pb-md-2">
      <div class="col-12">
        <div
          class="card-header border-0 text-white"
          style="background-color: white; padding: 2rem 2.25rem"
        >
          <div class="row">
            <div
              class="col-12 w-100 d-flex justify-content-between align-items-center"
            >
              <h3 class="card-title font-weight-bolder text-dark mb-0">
                {{ "MENU.LEARNING_PLATFORM.CREATE_EXERCISE" | translate }}
              </h3>
              <div>
                <button
                  class="btn btn-primary pr-1 pr-md-3"
                  (click)="onSubmit()"
                  [disabled]="exerciseForm.invalid || isLoading"
                >
                  <i class="fas fa-save"></i>
                  <span
                    *ngIf="!isLoading; else loadingSpan"
                    class="d-none d-md-inline ml-1"
                    >Create</span
                  >
                  <ng-template #loadingSpan>
                    <span class="d-none d-md-inline ml-1">Loading...</span>
                  </ng-template>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Body -->
    <div class="card-body">
      <!--begin: Item-->
      <div class="form-group row align-items-start">
        <label class="col-12 col-md-2 font-weight-bold mb-2 h3 mb-md-0"
          >Title</label
        >
        <div class="col-12 col-md-10">
          <div class="row">
            <div class="col-12">
              <input
                type="text"
                class="form-control form-control-solid"
                [class.is-invalid]="
                  exerciseForm.get('title').invalid &&
                  (exerciseForm.get('title').dirty ||
                    exerciseForm.get('title').touched)
                "
                placeholder="Enter title"
                formControlName="title"
                required
                [disabled]="isLoading"
              />
            </div>
            <div class="col-12">
              <small
                class="text-danger"
                *ngIf="
                  exerciseForm.get('title').invalid &&
                  (exerciseForm.get('title').dirty ||
                    exerciseForm.get('title').touched)
                "
              >
                Title is required.
              </small>
            </div>
          </div>
        </div>
      </div>

      <div class="form-group row">
        <label class="col-12 col-md-2 font-weight-bold mb-2 h3 mb-md-0"
          >Description</label
        >
        <div class="col-12 col-md-10">
          <textarea
            class="form-control form-control-solid"
            placeholder="Enter description (optional)"
            formControlName="description"
            rows="3"
            [disabled]="isLoading"
          ></textarea>
        </div>
      </div>

      <div class="form-group row">
        <label class="col-12 col-md-2 font-weight-bold mb-2 h3 mb-md-0"
          >Exercise Type</label
        >
        <div class="col-12 col-md-10">
          <select
            class="form-control form-control-solid"
            formControlName="exerciseType"
            [disabled]="isLoading"
            (change)="onExerciseTypeChange()"
          >
            <option value="">Select Exercise Type</option>
            <option
              *ngFor="let type of exerciseTypes$ | async"
              [value]="type.id"
            >
              {{ type.name }}
            </option>
          </select>
          <small
            class="text-danger"
            *ngIf="
              exerciseForm.get('exerciseType').invalid &&
              (exerciseForm.get('exerciseType').dirty ||
                exerciseForm.get('exerciseType').touched)
            "
          >
            Exercise type is required.
          </small>
        </div>
      </div>

      <div class="form-group row" *ngIf="!shouldHideMaxGrade()">
        <label class="col-12 col-md-2 font-weight-bold mb-2 h3 mb-md-0">Max Grade</label>
        <div class="col-12 col-md-10">
          <input
            type="number"
            class="form-control form-control-solid"
            placeholder="Enter maximum grade"
            formControlName="maxGrade"
            [disabled]="isLoading"
            min="1"
          />
          <small
            class="text-danger"
            *ngIf="
              exerciseForm.get('maxGrade').invalid &&
              (exerciseForm.get('maxGrade').dirty || exerciseForm.get('maxGrade').touched)
            "
          >
            Max grade must be at least 1.
          </small>
        </div>
      </div>

      <div class="form-group row">
        <label class="col-12 col-md-2 font-weight-bold mb-2 h3 mb-md-0"
          >Files</label
        >
        <div class="col-12 col-md-10">
          <div
            class="custom-dropzone form-control form-control-solid border"
            ngx-dropzone
            (change)="onSelectFiles($event)"
            [class.is-invalid]="
              exerciseForm.get('files').invalid &&
              (exerciseForm.get('files').dirty ||
                exerciseForm.get('files').touched)
            "
          >
            <ngx-dropzone-label>
              <p class="form-text text-muted">
                {{ "REGISTRATION.SCANS.DROP_SELECT" | translate }}
              </p>
            </ngx-dropzone-label>
            <ngx-dropzone-image-preview
              ngProjectAs="ngx-dropzone-preview"
              *ngFor="let f of files"
              [file]="f"
              [removable]="true"
              (removed)="onRemoveFile(f)"
            >
            </ngx-dropzone-image-preview>
          </div>
          <small
            class="text-danger"
            *ngIf="
              exerciseForm.get('files').invalid &&
              (exerciseForm.get('files').dirty ||
                exerciseForm.get('files').touched)
            "
          >
            At least one file is required.
          </small>
        </div>
      </div>
    </div>
  </div>
</form>
<ng-template #noAccess> You have no access to this page. </ng-template>

<!-- Confirmation Modal -->
<ng-template #settingsModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title">Exercise settings</h5>
    <button
      type="button"
      class="close"
      (click)="modal.dismiss()"
      aria-label="Close"
    >
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form [formGroup]="settingsForm">
      <div class="form-group row align-items-center">
        <label class="col-12 col-md-5 font-weight-bold mb-2 mb-md-0"
          >Deadline</label
        >
        <div class="col-12 col-md-7">
          <input
          type="date"
          class="form-control form-control-solid"
          formControlName="deadline"
          required
          />
        </div>
      </div>
    </form>
  </div>
  <div class="modal-footer d-flex">
    <!-- <button type="button" class="btn btn-danger" (click)="modal.dismiss()">
      {{ "BUTTONS.REMOVE" | translate }}
    </button> -->
    <button
      type="button"
      class="btn btn-secondary ml-auto"
      (click)="modal.dismiss()"
    >
      {{ "BUTTONS.CANCEL" | translate }}
    </button>
    <button type="button" class="btn btn-primary" (click)="saveSettings()">
      {{ "BUTTONS.SAVE" | translate }}
    </button>
  </div>
</ng-template>
